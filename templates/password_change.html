{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container" style="margin-top: 80px">

    {% if messages %}
      {% for message in messages %}
        <div class="notification is-{{ message.tags }} is-light">
          <button class="delete" onclick="this.parentElement.style.display='none'"></button>
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <div class="tabs is-boxed">
        <ul>
            <li><a href="{% url 'profile' %}">Profile</a></li>
            <li class="is-active"><a href="/password_change/">Password</a></li>
        </ul>
    </div>

    <div class="column is-half-desktop is-full-mobile">
        <h2 class="title is-4">Change Password</h2>
        
        <form method="post">
            {% csrf_token %}
            
            {% for field in form %}
                <div class="field">
                    <label class="label">{{ field.label }}</label>
                    <div class="control has-icons-right" style="position: relative;">
                        <input 
                            type="password" 
                            name="{{ field.name }}" 
                            id="{{ field.auto_id }}" 
                            class="input {% if field.errors %}is-danger{% endif %}"
                        >
                        <span class="icon is-small is-right is-clickable" 
                              onclick="togglePassword('{{ field.auto_id }}', this)" 
                              style="pointer-events: all; cursor: pointer;">
                            <i class="fas fa-eye" id="icon-{{ field.auto_id }}"></i>
                        </span>
                    </div>
                    {% if field.errors %}
                        <p class="help is-danger">{{ field.errors|striptags }}</p>
                    {% endif %}
                    {% if field.help_text %}
                        <p class="help">{{ field.help_text|safe }}</p>
                    {% endif %}
                </div>
            {% endfor %}

            <div class="field mt-5">
                <button type="submit" class="button is-primary">Update Password</button>
            </div>
        </form>
    </div>
</div>

<script>
function togglePassword(fieldId, el) {
    const input = document.getElementById(fieldId);
    const icon = document.getElementById('icon-' + fieldId);
    
    if (input.type === "password") {
        input.type = "text";
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = "password";
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}